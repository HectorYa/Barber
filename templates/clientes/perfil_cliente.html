{% extends "layout.html" %}
{% block content %}
<div class="container mt-4">
    <h2>{{ cliente.nombre }}</h2>
    <p><strong>DNI:</strong> {{ cliente.dni }}</p>
    <p><strong>Teléfono:</strong> {{ cliente.telefono }}</p>
    <p><strong>Correo:</strong> {{ cliente.correo }}</p>

    <div class="d-flex mb-3">
    <a href="{{ url_for('main.editar_cliente', id=cliente.id) }}" class="btn btn-warning mr-2">
        <i class="fas fa-edit"></i> Editar
    </a>
    <form method="POST" action="{{ url_for('main.eliminar_cliente', id=cliente.id) }}"
            onsubmit="return confirm('¿Estás seguro de eliminar este cliente?');">
        <button type="submit" class="btn btn-danger">
        <i class="fas fa-trash"></i> Eliminar
        </button>
    </form>
    </div>

    <div class="row my-3">
    <div class="col-md-4">
        <div class="card bg-light border-success shadow">
        <div class="card-body text-center">
            <h5 class="card-title">Total de Servicios Realizados</h5>
            <h3>{{reservas | map(attribute='servicios_detalle') | map('length') | sum}}</h3>
        </div>
        </div>
    </div>
    </div>


    <h4>Historial de Reservas</h4>

    {% if reservas %}
    <p><strong>Total de reservas:</strong> {{ reservas | length }}</p>
    <table class="table table-striped table-bordered">
        <thead>
        <tr>
            <th>Fecha</th>
            <th>Servicio</th>
            <th>¿Quién se lo hizo?</th>
            <th>Barbero</th>
            <th>Monto</th>
            <th>Estado</th>
        </tr>
        </thead>
        <tbody>
        {% for r in reservas %}
        {% for detalle in r.servicios_detalle %}
            <tr>
            <td>{{ r.fecha_reserva }}</td>
            <td>{{ detalle.servicio.nombre }}</td>
            <td>{{ detalle.persona_atendida }}</td>
            <td>{{ detalle.barbero.nickname }}</td>
            <td>S/. {{ detalle.precio_final }}</td>
            <td>{{ r.estado_pago }}</td>
            </tr>
        {% endfor %}

        {% endfor %}

        </tbody>
    </table>
    {% else %}
    <p class="text-muted">Este cliente no tiene reservas registradas.</p>
    {% endif %}


</div>
{% endblock %}
